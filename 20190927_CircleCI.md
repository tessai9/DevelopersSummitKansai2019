# CI/CDを使い倒して数段上のおソフトウェア開発をしよう

## スライド
https://speakerdeck.com/kimh/cdwoshi-idao-siteshu-duan-shang-falsesohutoueakai-fa-wosiyou-debusamiguan-xi

## CI
### CIとは
テストを自動で実行する仕組み  
開発者のコード変更に対して

- 常に
- 同じ環境で

テストを実行してくれる

### なぜCIすべき？
ただテストを書くだけでは不充分  
CIを使うことでテストの新陳代謝を高めて信頼性をあげる

1. テストに実行忘れ
	- 問題

	  リリース前にし忘れる  
	  バグを見落とす  
	  修正でリリースが遅れる

	-  CIでの解決

	  常にテストを回す  
	  Githubの変更をCI/CDが検知

2. テストが壊れてしまう
	- 問題

	  古いテストが壊れている  
	  テストが悪いのかコードがわからない

	- CIでの解決

	  テストが壊れた時点で検知  
	  直さないとマージできない

3. テスト結果が環境依存
	- 問題

	  僕のマシンでは通ってます  
	  CIではこけてる

	- CIでの解決

	  CIを唯一のテスト環境にする  
	  毎回同じテスト環境が構築される  
	  まっさらな環境でテストを実行  
	  いつ実行しても同じテスト結果になる

### CI導入を妨げる問題
#### テストがない

   CIを導入する上で一番厄介な問題  
   導入するための5step

   1. お好みのCI/CDツールを使う  

   2. 様々なタスクを自動化する

   	テスト以外のタスクを自動化
	- 構文チェック
	- カバレッジ計測
	- etc...

   3. 可視化しよう

        CI結果を可視化しよう
        - ステータスバッジ
        - ダッシュボードの作成
        - etc...

   4. マージブロックが有効か

   5. テストの追加

	- 少しずつテストを追加していく
	- ユニットテストはとりあえず後回し

#### メンテナンス
  CI/CDツールのメンテナンスは大変  
  通常仙人のエンジニアが必要

### CD
### CDとは
- Continuous Delivery

	リリース作業に人間の意思が介在する  
	「リリースできるものを作るところまで」がDelivery

- Continuous Deployment

	リリースに人の意思が介在しない  
	「本番環境への反映まで自動でする」がDeployment

### CDをすると？
- リリース後に発覚する仕様バグ

	本当に必要な機能はクライアント/ユーザーにも使ってみないとわからない

- 解決：フィードバックループを使う

	細かい単位でリリース  
	フィードバックを早めに得る  
	改善する

- CDなしだとループが回らない

	`No CD, No Feedback Loop`

### CD導入を妨げる問題
そもそもシステムがCDに向いていない  
新システムにはまずCI/CDを導入しよう

1. エンタープライズなアーキテクチャー

2. レガシー（技術的負債が多い）アーキテクチャー

	- 解決：時間をかけてアップデート

	- CD導入の銀の弾丸はない
	  - サービスの疎結合
	  - 徐々にモダン化

	- CircleCIでの事例
	  - before
	    - 常に200台以上のビルドマシンからなるフリート
	    - Chat Opsでデプロイ
	    - およそ二日で完全に入れ替え
	    - しばらく古いコードと新しいコードが混在する問題

	  - after
	    - DockerとKubernetesの導入
	    - マイクロサービス化

### CDを導入すると？
1. 迅速なロールバック
2. 本番環境でのテスト
3. 高度なリリース手法
    - カナリーリリース
    - ブルーグリーンデプロイ
